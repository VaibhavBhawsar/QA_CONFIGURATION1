name: Validate Config Files

on:
  pull_request:
    branches:
      - main
    paths:
      - "config/*.cfg"  # Run only if .cfg files in "config/"

jobs:
  validate_cfg:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip

      - name: Get changed .cfg files
        id: changed_files
        run: |
          CHANGED_FILES=$(git diff --name-only --diff-filter=AM origin/main HEAD -- 'config/*.cfg' || echo "")
          echo "CHANGED_FILES=$CHANGED_FILES" >> $GITHUB_ENV
          echo "Changed config files: $CHANGED_FILES"

      - name: Run validation on changed config files
        if: env.CHANGED_FILES != ''
        run: |
          python utils/check_cfg_params.py $CHANGED_FILES config/expected.cfg

      - name: Fail PR on validation errors
        if: failure()
        run: exit 1
